name: Run Postman Collection and Send Report

on:
  push:
    branches:
      - main  # Change to your branch name if needed

jobs:
  postman-tests:
    runs-on: ubuntu-latest

    steps:
      - name: ‚¨áÔ∏è Checkout code
        uses: actions/checkout@v3

      - name: üîß Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: üì¶ Install Newman and HTML reporter
        run: |
          npm install -g newman
          npm install -g newman-reporter-htmlextra

      - name: üß™ Run Postman Collection with HTML report
        run: |
          newman run CLCollection.postman_collection.json -r htmlextra --reporter-htmlextra-export newman-report.html

      - name: ‚úâÔ∏è Send Email with HTML Report
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: API Test result
          to: anand@moontechnolabs.com
          from: ${{ secrets.EMAIL_USERNAME }}
          content_type: text/html
          attachments: newman-report.html
          body: |
            <p>Hi Anand,</p>
            <p>Please find attached the latest API test result HTML report.</p>
            <p>Thanks,<br>CI/CD Pipeline</p>
